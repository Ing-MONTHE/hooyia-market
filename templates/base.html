{% load static %}
<!DOCTYPE html>
<html lang="fr" data-theme="light" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{% block title %}HooYia Market{% endblock %}</title>
  <meta name="description" content="{% block meta_description %}HooYia Market ‚Äî √âlectronique & Informatique au meilleur prix{% endblock %}" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Sora:wght@300;400;500;600;700;800&family=Plus+Jakarta+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,400&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet" />

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            brand: {
              50:  'var(--brand-50)',
              100: 'var(--brand-100)',
              200: 'var(--brand-200)',
              300: 'var(--brand-300)',
              400: 'var(--brand-400)',
              500: 'var(--brand-500)',
              600: 'var(--brand-600)',
            },
            accent: {
              400: '#fb923c',
              500: '#F97316',
              600: '#ea6000',
            },
          },
          fontFamily: {
            display: ['Sora', 'system-ui', 'sans-serif'],
            body:    ['"Plus Jakarta Sans"', 'system-ui', 'sans-serif'],
            mono:    ['"JetBrains Mono"', 'monospace'],
          },
        },
      },
    }
  </script>

  <!-- Custom CSS -->
  <link rel="stylesheet" href="{% static 'css/custom.css' %}" />

  <!-- Dark mode init (avant rendu pour √©viter le flash) -->
  <script>
    (function() {
      const saved = localStorage.getItem('hooyia-theme');
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      const theme = saved || (prefersDark ? 'dark' : 'light');
      document.documentElement.setAttribute('data-theme', theme);
      if (theme === 'dark') document.documentElement.classList.add('dark');
    })();
  </script>

  {% block extra_head %}{% endblock %}
</head>

<body style="background:var(--bg);color:var(--text-primary);font-family:'Plus Jakarta Sans',sans-serif;" class="min-h-screen flex flex-col antialiased transition-colors duration-200">

  <!-- NAVBAR -->
  {% include 'partials/navbar.html' %}

  <!-- FLASH MESSAGES -->
  {% if messages %}
  <div id="django-messages" class="fixed top-20 right-4 z-50 flex flex-col gap-2 max-w-sm w-full pointer-events-none">
    {% for message in messages %}
    <div class="message-toast pointer-events-auto animate-toast-in"
      style="background:var(--surface);border:1px solid var(--border);border-radius:0.875rem;padding:0.875rem 1rem;display:flex;align-items:flex-start;gap:0.75rem;box-shadow:var(--shadow-lg);
      {% if message.tags == 'success' %}border-left:3px solid #10b981;{% elif message.tags == 'error' %}border-left:3px solid #ef4444;{% elif message.tags == 'warning' %}border-left:3px solid #f59e0b;{% else %}border-left:3px solid var(--brand-500);{% endif %}">
      <span style="font-size:1rem;flex-shrink:0;margin-top:1px;">
        {% if message.tags == 'success' %}‚úì{% elif message.tags == 'error' %}‚úï{% elif message.tags == 'warning' %}‚ö†{% else %}‚Ñπ{% endif %}
      </span>
      <p style="font-size:0.8125rem;font-weight:500;color:var(--text-primary);flex:1;line-height:1.5;">{{ message }}</p>
      <button onclick="this.closest('.message-toast').remove()" style="opacity:.4;background:none;border:none;cursor:pointer;color:var(--text-primary);font-size:0.75rem;padding:0;line-height:1;flex-shrink:0;" onmouseover="this.style.opacity='.8'" onmouseout="this.style.opacity='.4'">‚úï</button>
    </div>
    {% endfor %}
  </div>
  {% endif %}

  <!-- MAIN CONTENT -->
  <main class="flex-1 {% block main_class %}{% endblock %}">
    {% block content %}{% endblock %}
  </main>

  <!-- FOOTER -->
  {% block footer %}{% include 'partials/footer.html' %}{% endblock %}

  <!-- TOAST CONTAINER -->
  {% include 'partials/toast.html' %}

  <!-- SCRIPTS -->
  <script src="{% static 'js/api.js' %}"></script>
  {% if user.is_authenticated %}
  <script src="{% static 'js/notifications.js' %}"></script>
  {% endif %}

  <!-- Auto-dismiss flash -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('.message-toast').forEach((el, i) => {
        setTimeout(() => {
          el.style.animation = 'toastOut 0.25s ease forwards';
          setTimeout(() => el.remove(), 250);
        }, 4500 + i * 300);
      });
    });

    // Dark mode toggle global
    window.toggleTheme = function() {
      const html = document.documentElement;
      const isDark = html.getAttribute('data-theme') === 'dark';
      const next = isDark ? 'light' : 'dark';
      html.setAttribute('data-theme', next);
      html.classList.toggle('dark', !isDark);
      localStorage.setItem('hooyia-theme', next);
      // Update all toggle icons
      document.querySelectorAll('[data-theme-icon]').forEach(el => {
        el.textContent = isDark ? 'üåô' : '‚òÄÔ∏è';
      });
    }
  </script>

  <!-- ‚ïê‚ïê MODAL CONFIRMATION GLOBAL ‚ïê‚ïê -->
  <div id="g-confirm-overlay" style="display:none;position:fixed;inset:0;z-index:9999;background:rgba(10,18,50,.55);backdrop-filter:blur(3px);align-items:center;justify-content:center;padding:20px;">
    <div id="g-confirm-box" style="background:white;border-radius:18px;max-width:400px;width:100%;box-shadow:0 28px 80px rgba(10,18,50,.25);overflow:hidden;transform:scale(.94) translateY(10px);opacity:0;transition:all .2s cubic-bezier(.34,1.56,.64,1);">
      <div id="g-confirm-header" style="padding:22px 24px 18px;display:flex;align-items:center;gap:14px;">
        <div id="g-confirm-icon-wrap" style="width:44px;height:44px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0;"></div>
        <div id="g-confirm-title" style="font-family:'Syne',sans-serif;font-size:16px;font-weight:700;line-height:1.3;"></div>
      </div>
      <div id="g-confirm-body" style="padding:0 24px 20px;font-size:13.5px;color:#64748b;line-height:1.6;"></div>
      <div style="padding:0 20px 20px;display:flex;gap:8px;justify-content:flex-end;">
        <button id="g-confirm-cancel" style="padding:10px 20px;border-radius:9px;border:1.5px solid #e2e8f8;background:white;font-weight:600;font-size:13px;cursor:pointer;color:#64748b;font-family:DM Sans,sans-serif;transition:all .12s;">Annuler</button>
        <button id="g-confirm-ok" style="padding:10px 22px;border-radius:9px;border:none;font-weight:600;font-size:13px;cursor:pointer;font-family:DM Sans,sans-serif;transition:all .12s;"></button>
      </div>
    </div>
  </div>
  <script>
  function showConfirm({ title='Confirmer', body='', confirmText='Confirmer', type='danger', hideCancelBtn=false }={}) {
    return new Promise(resolve => {
      const overlay=document.getElementById('g-confirm-overlay'),box=document.getElementById('g-confirm-box'),
        iconWrap=document.getElementById('g-confirm-icon-wrap'),titleEl=document.getElementById('g-confirm-title'),
        bodyEl=document.getElementById('g-confirm-body'),okBtn=document.getElementById('g-confirm-ok'),
        cancelBtn=document.getElementById('g-confirm-cancel'),header=document.getElementById('g-confirm-header');
      const T={danger:{bg:'#fff5f5',iconBg:'#fee2e2',icon:'üóëÔ∏è',tc:'#991b1b',btn:'#ef4444'},
               warning:{bg:'#fffbeb',iconBg:'#fef3c7',icon:'‚ö†Ô∏è',tc:'#92400e',btn:'#f59e0b'},
               info:{bg:'#eff6ff',iconBg:'#dbeafe',icon:'‚ÑπÔ∏è',tc:'#1e3a8a',btn:'#3b82f6'}};
      const t=T[type]||T.danger;
      header.style.background=t.bg; iconWrap.style.background=t.iconBg; iconWrap.textContent=t.icon;
      titleEl.style.color=t.tc; titleEl.textContent=title; bodyEl.innerHTML=body;
      okBtn.textContent=confirmText; okBtn.style.background=t.btn; okBtn.style.color='white';
      okBtn.style.boxShadow='0 2px 10px '+t.btn+'55';
      cancelBtn.style.display=hideCancelBtn?'none':'';
      overlay.style.display='flex';
      requestAnimationFrame(()=>{ box.style.transform='scale(1) translateY(0)'; box.style.opacity='1'; });
      function close(r){ box.style.transform='scale(.94) translateY(10px)'; box.style.opacity='0';
        setTimeout(()=>{ overlay.style.display='none'; },180);
        okBtn.removeEventListener('click',onOk); cancelBtn.removeEventListener('click',onCancel);
        overlay.removeEventListener('click',onBg); resolve(r); }
      const onOk=()=>close(true), onCancel=()=>close(false), onBg=(e)=>{ if(e.target===overlay) close(false); };
      okBtn.addEventListener('click',onOk); cancelBtn.addEventListener('click',onCancel);
      overlay.addEventListener('click',onBg);
    });
  }
  </script>

  {% block extra_scripts %}{% endblock %}
</body>
</html>