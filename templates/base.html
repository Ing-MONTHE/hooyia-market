{% load static %}
<!DOCTYPE html>
<html lang="fr" data-theme="light" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{% block title %}HooYia Market{% endblock %}</title>
  <meta name="description" content="{% block meta_description %}HooYia Market ‚Äî √âlectronique & Informatique au meilleur prix{% endblock %}" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Sora:wght@300;400;500;600;700;800&family=Plus+Jakarta+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,400&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet" />

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            brand: {
              50:  'var(--brand-50)',
              100: 'var(--brand-100)',
              200: 'var(--brand-200)',
              300: 'var(--brand-300)',
              400: 'var(--brand-400)',
              500: 'var(--brand-500)',
              600: 'var(--brand-600)',
            },
            accent: {
              400: '#fb923c',
              500: '#F97316',
              600: '#ea6000',
            },
          },
          fontFamily: {
            display: ['Sora', 'system-ui', 'sans-serif'],
            body:    ['"Plus Jakarta Sans"', 'system-ui', 'sans-serif'],
            mono:    ['"JetBrains Mono"', 'monospace'],
          },
        },
      },
    }
  </script>

  <!-- Custom CSS -->
  <link rel="stylesheet" href="{% static 'css/custom.css' %}" />

  <!-- Dark mode init (avant rendu pour √©viter le flash) -->
  <script>
    (function() {
      const saved = localStorage.getItem('hooyia-theme');
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      const theme = saved || (prefersDark ? 'dark' : 'light');
      document.documentElement.setAttribute('data-theme', theme);
      if (theme === 'dark') document.documentElement.classList.add('dark');
    })();
  </script>

  {% block extra_head %}{% endblock %}
</head>

<body style="background:var(--bg);color:var(--text-primary);font-family:'Plus Jakarta Sans',sans-serif;" class="min-h-screen flex flex-col antialiased transition-colors duration-200">

  <!-- NAVBAR -->
  {% include 'partials/navbar.html' %}

  <!-- FLASH MESSAGES -->
  {% if messages %}
  <div id="django-messages" class="fixed top-20 right-4 z-50 flex flex-col gap-2 max-w-sm w-full pointer-events-none">
    {% for message in messages %}
    <div class="message-toast pointer-events-auto animate-toast-in"
      style="background:var(--surface);border:1px solid var(--border);border-radius:0.875rem;padding:0.875rem 1rem;display:flex;align-items:flex-start;gap:0.75rem;box-shadow:var(--shadow-lg);
      {% if message.tags == 'success' %}border-left:3px solid #10b981;{% elif message.tags == 'error' %}border-left:3px solid #ef4444;{% elif message.tags == 'warning' %}border-left:3px solid #f59e0b;{% else %}border-left:3px solid var(--brand-500);{% endif %}">
      <span style="font-size:1rem;flex-shrink:0;margin-top:1px;">
        {% if message.tags == 'success' %}‚úì{% elif message.tags == 'error' %}‚úï{% elif message.tags == 'warning' %}‚ö†{% else %}‚Ñπ{% endif %}
      </span>
      <p style="font-size:0.8125rem;font-weight:500;color:var(--text-primary);flex:1;line-height:1.5;">{{ message }}</p>
      <button onclick="this.closest('.message-toast').remove()" style="opacity:.4;background:none;border:none;cursor:pointer;color:var(--text-primary);font-size:0.75rem;padding:0;line-height:1;flex-shrink:0;" onmouseover="this.style.opacity='.8'" onmouseout="this.style.opacity='.4'">‚úï</button>
    </div>
    {% endfor %}
  </div>
  {% endif %}

  <!-- MAIN CONTENT -->
  <main class="flex-1 {% block main_class %}{% endblock %}">
    {% block content %}{% endblock %}
  </main>

  <!-- FOOTER -->
  {% block footer %}{% include 'partials/footer.html' %}{% endblock %}

  <!-- TOAST CONTAINER -->
  {% include 'partials/toast.html' %}

  <!-- SCRIPTS -->
  <script src="{% static 'js/api.js' %}"></script>
  {% if user.is_authenticated %}
  <script src="{% static 'js/notifications.js' %}"></script>
  {% endif %}

  <!-- Auto-dismiss flash -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('.message-toast').forEach((el, i) => {
        setTimeout(() => {
          el.style.animation = 'toastOut 0.25s ease forwards';
          setTimeout(() => el.remove(), 250);
        }, 4500 + i * 300);
      });
    });

    // Dark mode toggle global
    window.toggleTheme = function() {
      const html = document.documentElement;
      const isDark = html.getAttribute('data-theme') === 'dark';
      const next = isDark ? 'light' : 'dark';
      html.setAttribute('data-theme', next);
      html.classList.toggle('dark', !isDark);
      localStorage.setItem('hooyia-theme', next);
      // Update all toggle icons
      document.querySelectorAll('[data-theme-icon]').forEach(el => {
        el.textContent = isDark ? 'üåô' : '‚òÄÔ∏è';
      });
    }
  </script>

  {% block extra_scripts %}{% endblock %}
</body>
</html>